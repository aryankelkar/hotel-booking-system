<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Room - Hotel Booking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-hotel me-2"></i>Hotel Booking System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item mx-1">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item mx-1">
                        <a class="nav-link active" href="/rooms"><i class="fas fa-door-open me-1"></i> Rooms</a>
                    </li>
                    <li class="nav-item mx-1">
                        <a class="nav-link" href="/bookings"><i class="fas fa-calendar-check me-1"></i> Bookings</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5 fade-in">
        <h1 class="page-header">Book a Room</h1>
        <p class="lead text-muted mb-4">Complete the form below to make your reservation</p>
        
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-body p-4">
                        <form th:action="@{/bookings/book}" th:object="${booking}" method="post" class="needs-validation" novalidate>
                            <div class="row">
                                <div class="col-md-6 form-group mb-4">
                                    <label for="customerName" class="form-label">Customer Name</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                                        <input type="text" class="form-control" id="customerName" th:field="*{customerName}" placeholder="Enter full name" required>
                                    </div>
                                    <div class="invalid-feedback">Please provide your name.</div>
                                </div>
                                
                                <div class="col-md-6 form-group mb-4">
                                    <label for="contact" class="form-label">Email Address</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                        <input type="email" class="form-control" id="contact" th:field="*{contact}" placeholder="Enter email address" required>
                                    </div>
                                    <div class="invalid-feedback">Please provide a valid email.</div>
                                </div>
                            </div>
                            
                            <div class="form-group mb-4">
                                <label for="phoneNumber" class="form-label">Phone Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input type="tel" class="form-control" id="phoneNumber" th:field="*{phoneNumber}" 
                                        pattern="[0-9]{10}" title="Phone number must be exactly 10 digits" 
                                        placeholder="Enter 10-digit phone number" required>
                                </div>
                                <div class="form-text"><small><i class="fas fa-info-circle me-1"></i> Enter a 10-digit phone number without spaces or dashes</small></div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12 form-group mb-4">
                                    <label for="checkIn" class="form-label">Check-in Date</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                                        <input type="date" class="form-control" id="checkIn" th:field="*{checkIn}" required>
                                    </div>
                                    <div class="invalid-feedback">Please select a check-in date.</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12 form-group mb-4">
                                    <label for="checkOut" class="form-label">Check-out Date</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-calendar-times"></i></span>
                                        <input type="date" class="form-control" id="checkOut" th:field="*{checkOut}" required>
                                    </div>
                                    <div class="invalid-feedback">Please select a check-out date.</div>
                                </div>
                            </div>
                            
                            <div class="form-group mb-4">
                                <label for="roomId" class="form-label">Select Room</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-bed"></i></span>
                                    <select class="form-select" id="roomId" th:field="*{roomId}" required>
                                        <option value="" selected disabled>Select a Room</option>
                                        <option th:each="room : ${availableRooms}" 
                                                th:value="${room.roomId}"
                                                th:data-price="${room.price}" 
                                                th:text="${'Room ' + room.roomNumber + ' - ' + room.type + ' (₹' + room.price + ')'}">
                                        </option>
                                    </select>
                                </div>
                                <div class="invalid-feedback">Please select a room.</div>
                            </div>

                            <div class="card bg-light mb-4">
                                <div class="card-body">
                                    <h5 class="card-title mb-3">Booking Summary</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-2">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-calendar-day me-2 text-primary"></i>
                                                <div>
                                                    <small class="text-muted">Stay Duration</small>
                                                    <div class="fw-bold"><span id="stayDays">1</span> day(s)</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-rupee-sign me-2 text-success"></i>
                                                <div>
                                                    <small class="text-muted">Total Price</small>
                                                    <div class="fw-bold">₹<span id="finalPrice">0</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between mt-4">
                                <a href="/rooms" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i> Back to Rooms</a>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-check-circle me-1"></i> Confirm Booking</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

   

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Date validation - prevent selecting past dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('checkIn').setAttribute('min', today);
        document.getElementById('checkOut').setAttribute('min', today);
        
        // Calculate stay duration and price
        function computeDays() {
            const inEl = document.getElementById('checkIn');
            const outEl = document.getElementById('checkOut');
            if (!inEl.value || !outEl.value) return 0;
            const inDate = new Date(inEl.value);
            const outDate = new Date(outEl.value);
            const ms = outDate - inDate;
            const days = Math.floor(ms / (1000 * 60 * 60 * 24));
            return days > 0 ? days : 0;
        }
        
        function getSelectedRoomPrice() {
            const select = document.getElementById('roomId');
            const opt = select.options[select.selectedIndex];
            const price = opt ? parseFloat(opt.getAttribute('data-price')) : 0;
            return isNaN(price) ? 0 : price;
        }
        
        function updatePricing() {
            let days = computeDays();
            document.getElementById('stayDays').textContent = days > 0 ? days : 1;
            const pricePerDay = getSelectedRoomPrice();
            const total = (days > 0 ? days : 1) * pricePerDay;
            document.getElementById('finalPrice').textContent = total.toFixed(2);
        }
        
        ['checkIn','checkOut','roomId'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('change', updatePricing);
        });
        
        document.addEventListener('DOMContentLoaded', updatePricing);
        
        // Form validation
        (function() {
            'use strict';
            var forms = document.querySelectorAll('.needs-validation');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();
    </script>
</body>
</html>